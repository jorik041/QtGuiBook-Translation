<html>
<head><meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="generator" content="chm2web Pro 2.85 (unicode)" />

<title>ch05lev1sec3.html</title>
<link rel="stylesheet" href="../../files/helpindex.css" type=
"text/css">
<link rel="stylesheet" href="../../default.css" type="text/css">

<script type="text/JavaScript" src="../../files/supply.js"></script>
<script type="text/JavaScript">
chmtop.c2wtopf.pageid = "final/ch05lev1sec3.html";
</script>

</head>
<body><script type="text/JavaScript"> 
if (window.name != "content") 
  document.write(" <table width=\"100%\" bgcolor=\"#e1e1e1\"cellspacing=\"2\" cellpadding=\"0\" style=\"border-collapse: collapse; font-family: sans-serif; font-size: 14px; color: #000000; text-decoration: none;  \"> <tr> <td align=\"center\" style=\"border-bottom: 2px solid gray\" > <br>&nbsp;Click <a href=\"../../index.html?page=sources%2Ffinal%2Fch05lev1sec3.html\">here</a> to show toolbars of the Web Online Help System: <a href=\"../../index.html?page=sources%2Ffinal%2Fch05lev1sec3.html\">show toolbars</a><br>&nbsp;</td></tr></table><br> "); 
</script>
<!-- !chm2web! -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td align="right">
<div style="MARGIN-LEFT: 0.15in;"><a href=
"ch05lev1sec2.html"><img src="images/prev.gif" width="20" height=
"20" border="0" align="absmiddle" alt="Previous Page"></a> <a href=
"ch05lev1sec4.html"><img src="images/next.gif" width="20" height=
"20" border="0" align="absmiddle" alt="Next Page"></a></div>
</td>
</tr>
</table>

<div style="">
<div><a name="ch05lev1sec3"></a>
<h3 class="docSection1Title" id="-100000">Integrating Custom
Widgets with Qt Designer</h3>

<p class="docText"><a name="Before we"></a>Before we can use custom
widgets in <span class="docEmphasis">Qt Designer</span><a name=
"make"></a>, we must make <span class="docEmphasis">Qt
Designer</span><a name="of them"></a> aware of them. There are two
techniques for doing this: the "promotion" approach and the plugin
approach.</p>

<p class="docText"><a name="of choosing"></a>The promotion approach
is the quickest and easiest. It consists of choosing a built-in Qt
widget that has a similar API to the one we want our custom widget
to have and filling in <span class="docEmphasis">Qt
Designer</span>'s custom widget dialog (shown in <a class="docLink"
href="#ch05fig06">Figure 5.6</a><a name="The custom"></a>) with
some information about the widget. The custom widget can then be
used in forms developed with <span class="docEmphasis">Qt
Designer</span><a name="widget while"></a>, although it will be
represented by the associated built-in Qt widget while the form is
edited or previewed.</p>
<a name="ch05fig06"></a>
<center>
<h5 class="docFigureTitle">Figure 5.6. <span class="docEmphasis">Qt
Designer</span>'s custom widget dialog</h5>

<p class="docText">
</p>

<div class="st1"><a target="_blank" href=
"images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzbHBpbl9kcy9oc2lyZXRlY3Fnc2F0anBnXy4-.jpg">
[View full size image]</a>
</div>
<img border="0" id="" width="500" height="360" src=
"images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcHBpbl9kc2gvc2lyZXRlY3Fnc2pnLg--.jpg"
alt="">
</center>
<br>

<p class="docText">Here's how to insert a <tt>HexSpinBox</tt>
widget into a form using this approach:</p>
<a name="ch05pro02"></a>
<table border="0" class="docText">
<tr>
<td width="25" valign="top">
<div class="docText"><b>1.</b>
</div>
</td>
<td>
<div class="docText">Create a <tt>QSpinBox</tt> by dragging it from
<span class="docEmphasis">Qt Designer</span>'s widget box onto the
form.<br>
<br></div>
</td>
</tr>

<tr>
<td>
</td>
<td>
</td>
</tr>

<tr>
<td width="25" valign="top">
<div class="docText"><b>2.</b>
</div>
</td>
<td>
<div class="docText"><a name="iddle2597"></a><a name=
"iddle3097"></a><a name="iddle3110"></a><a name=
"iddle3120"></a><a name="iddle3806"></a><a name=
"iddle3858"></a><a name="iddle4363"></a><a name=
"iddle4599"></a><a name="iddle4918"></a><a name=
"iddle7831"></a>Right-click the spin box and choose <span class=
"docEmphRomanAlt">Promote to Custom Widget</span> from the context
menu.<br>
<br></div>
</td>
</tr>

<tr>
<td width="25" valign="top">
<div class="docText"><b>3.</b>
</div>
</td>
<td>
<div class="docText">Fill in the dialog that pops up with
"HexSpinBox" as the class name and "hexspinbox.h" as the header
file.<br>
<br></div>
</td>
</tr>
</table>

<p class="docText">Voil√†! The code generated by <tt>uic</tt> will
include <tt>hexspinbox.h</tt> instead of <tt>&lt;QSpinBox&gt;</tt>
and instantiate a <tt>HexSpinBox</tt>. In <span class=
"docEmphasis">Qt Designer</span>, the <tt>HexSpinBox</tt> widget
will be represented by a <tt>QSpinBox</tt><a name=
"properties of"></a>, allowing us to set all the properties of a
<tt>QSpinBox</tt> (e.g., the range and the current value).</p>

<p class="docText"><a name="properties that"></a>The drawbacks of
the promotion approach are that properties that are specific to the
custom widget aren't accessible in <span class="docEmphasis">Qt
Designer</span><a name="that the"></a> and that the widget isn't
rendered as itself. Both these problems can be solved by using the
plugin approach.</p>

<p class="docText"><a name="that"></a>The plugin approach requires
the creation of a plugin library that <span class=
"docEmphasis"><a name="Qt Designer"></a>Qt Designer</span><a name=
"at run"></a> can load at run-time and use to create instances of
the widget. <span class="docEmphasis">Qt Designer</span><a name=
"uses the"></a> then uses the real widget when editing the form and
for previewing, and thanks to Qt's meta-object system, <span class=
"docEmphasis">Qt Designer</span><a name="how this"></a> can
dynamically obtain the list of its properties. To show how this
works, we will integrate the <tt>IconEditor</tt><a name=
"a plugin"></a> from the previous section as a plugin.</p>

<p class="docText">First, we must subclass
<tt>QDesignerCustomWidgetInterface</tt><a name="plugin source"></a>
and reimplement some virtual functions. We will assume that the
plugin source code is located in a directory called
<tt>iconeditorplugin</tt> and that the <tt>IconEditor</tt><a name=
"parallel directory"></a> source code is located in a parallel
directory called <tt>iconeditor</tt>.</p>

<p class="docText">Here's the class definition:</p>

<div class="docText">
<pre>
#include &lt;QDesignerCustomWidgetInterface&gt;

class IconEditorPlugin : public QObject,
                         public QDesignerCustomWidgetInterface
{
    Q_OBJECT
    Q_INTERFACES(QDesignerCustomWidgetInterface)

public:
    IconEditorPlugin(QObject *parent = 0);

    QString name() const;
    QString includeFile() const;
    QString group() const;
    QIcon icon() const;
    QString toolTip() const;
    QString whatsThis() const;
    bool isContainer() const;
    QWidget *createWidget(QWidget *parent);
};
</pre>
</div>
<br>

<p class="docText">The <tt>IconEditorPlugin</tt> subclass is a
factory class that encapsulates the <tt>IconEditor</tt> widget. It
is derived from both <tt>QObject</tt> and
<tt>QDesignerCustomWidgetInterface</tt> and uses the
<tt>Q_INTERFACES()</tt> macro to tell <tt>moc</tt> that the second
base class is a plugin <a name="iddle1401"></a><a name=
"iddle2960"></a><a name="iddle3095"></a><a name=
"iddle3111"></a><a name="iddle3113"></a><a name=
"iddle3114"></a><a name="iddle3115"></a><a name=
"iddle3117"></a><a name="iddle3118"></a><a name=
"iddle3119"></a><a name="iddle3199"></a><a name=
"iddle3975"></a><a name="iddle5182"></a><a name=
"iddle8146"></a><a name="iddle8147"></a><a name=
"iddle8280"></a><a name="iddle8364"></a><a name=
"iddle8532"></a>interface. <span class="docEmphasis">Qt
Designer</span><a name="class and"></a> uses the functions to
create instances of the class and to obtain information about
it.</p>

<div class="docText">
<pre>
IconEditorPlugin::IconEditorPlugin(QObject *parent)
    : QObject(parent)
{
}
</pre>
</div>
<br>

<p class="docText"><a name="constructor is"></a>The constructor is
trivial.</p>

<div class="docText">
<pre>
QString IconEditorPlugin::name() const
{
    return "IconEditor";
}
</pre>
</div>
<br>

<p class="docText">The <tt>name()</tt> function returns the name of
the widget provided by the plugin.</p>

<div class="docText">
<pre>
QString IconEditorPlugin::includeFile() const
{
    return "iconeditor.h";
}
</pre>
</div>
<br>

<p class="docText">The <tt>includeFile()</tt><a name=
"specified widget"></a> function returns the name of the header
file for the specified widget encapsulated by the plugin. The
header file is included in the code generated by the <tt>uic</tt>
tool.</p>

<div class="docText">
<pre>
QString IconEditorPlugin::group() const
{
    return tr("Image Manipulation Widgets");
}
</pre>
</div>
<br>

<p class="docText"><a name="The"></a>The <tt>group()</tt><a name=
"the name"></a> function returns the name of the widget box group
to which this custom widget should belong. If the name isn't
already in use, <span class="docEmphasis">Qt
Designer</span><a name="create a"></a> will create a new group for
the widget.</p>

<div class="docText">
<pre>
QIcon IconEditorPlugin::icon() const
{
    return QIcon(":/images/iconeditor.png");
}
</pre>
</div>
<br>

<p class="docText">The <tt>icon()</tt><a name="custom widget"></a>
function returns the icon to use to represent the custom widget in
<span class="docEmphasis">Qt Designer</span>'s widget box. Here, we
assume that the <tt>IconEditorPlugin</tt><a name="file with"></a>
has an associated Qt resource file with a suitable entry for the
icon editor image.</p>

<div class="docText">
<pre>
QString IconEditorPlugin::toolTip() const
{
    return tr("An icon editor widget");
}
</pre>
</div>
<br>

<p class="docText">The <tt>toolTip()</tt><a name="hovers over"></a>
function returns the tooltip to show when the mouse hovers over the
custom widget in <span class="docEmphasis">Qt Designer</span>'s
widget box.</p>

<div class="docText">
<pre>
QString IconEditorPlugin::whatsThis() const
{
    return tr("This widget is presented in Chapter 5 of &lt;i&gt;C++ GUI "
              "Programming with Qt 4&lt;/i&gt; as an example of a custom Qt "
              "widget.");
}
</pre>
</div>
<br>

<p class="docText"><a name="iddle1920"></a><a name=
"iddle2686"></a><a name="iddle3112"></a><a name=
"iddle3116"></a><a name="iddle3319"></a><a name=
"iddle4479"></a><a name="iddle4595"></a><a name="iddle8533"></a>The
<tt>whatsThis()</tt> function returns the "What's This?" text for
<span class="docEmphasis">Qt Designer</span> to display.</p>

<div class="docText">
<pre>
bool IconEditorPlugin::isContainer() const
{
    return false;
}
</pre>
</div>
<br>

<p class="docText">The <tt>isContainer()</tt> function returns
<tt>true</tt><a name="it returns"></a> if the widget can contain
other widgets; otherwise, it returns <tt>false</tt>. For example,
<tt>QFrame</tt><a name="any Qt"></a> is a widget that can contain
other widgets. In general, any Qt widget can contain other widgets,
but <span class="docEmphasis">Qt Designer</span><a name=
"this when"></a> disallows this when <tt>isContainer()</tt> returns
<tt>false</tt>.</p>

<div class="docText">
<pre>
QWidget *IconEditorPlugin::createWidget(QWidget *parent)
{
    return new IconEditor(parent);
}
</pre>
</div>
<br>

<p class="docText"><span class="docEmphasis">Qt Designer</span>
calls the <tt>createWidget()</tt><a name="the given"></a> function
to create an instance of a widget class with the given parent.</p>

<div class="docText">
<pre>
Q_EXPORT_PLUGIN2(iconeditorplugin, IconEditorPlugin)
</pre>
</div>
<br>

<p class="docText"><a name="At the"></a>At the end of the source
file that implements the plugin class, we must use the
<tt>Q_EXPORT_PLUGIN2()</tt><a name="make the"></a> macro to make
the plugin available to <span class="docEmphasis">Qt
Designer</span><a name="first argument"></a>. The first argument is
the name we want to give the plugin; the second argument is the
name of the class that implements it.</p>

<p class="docText">The <tt>.pro</tt> file for building the plugin
looks like this:</p>

<div class="docText">
<pre>
TEMPLATE     = lib
CONFIG      += designer plugin release
HEADERS      = ../iconeditor/iconeditor.h \
               iconeditorplugin.h
SOURCES      = ../iconeditor/iconeditor.cpp \
               iconeditorplugin.cpp
RESOURCES    = iconeditorplugin.qrc
DESTDIR      = $$[QT_INSTALL_PLUGINS]/designer
</pre>
</div>
<br>

<p class="docText">The <tt>qmake</tt><a name="of them"></a> build
tool has some predefined variables built into it. One of them is
<tt>$$[QT_INSTALL_PLUGINS]</tt><a name="the"></a>, which holds the
path to the <tt>plugins</tt><a name="type"></a> directory inside
the directory where Qt is installed. When you type <tt>make</tt> or
<tt>nmake</tt><a name="install itself"></a> to build the plugin, it
will automatically install itself in Qt's <tt>plugins/designer</tt>
directory. Once the plugin is built, the <tt>IconEditor</tt> widget
can be used in <span class="docEmphasis">Qt Designer</span> in the
same way as any of Qt's built-in widgets.</p>

<p class="docText"><a name="with"></a>If you want to integrate
several custom widgets with <span class="docEmphasis">Qt
Designer</span><a name="can either"></a>, you can either create one
plugin for each of them or combine them into a single plugin by
deriving from
<tt>QDesignerCustomWidgetCollectionInterface</tt>.</p>
</div>
</div>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td align="right">
<div style="MARGIN-LEFT: 0.15in;"><a href=
"ch05lev1sec2.html"><img src="images/prev.gif" width="20" height=
"20" border="0" align="absmiddle" alt="Previous Page"></a> <a href=
"ch05lev1sec4.html"><img src="images/next.gif" width="20" height=
"20" border="0" align="absmiddle" alt="Next Page"></a></div>
</td>
</tr>
</table>

<script type="text/JavaScript">
var fe = FindFrame("toc", top);
if ((fe != null) && (chmtop.c2wtopf.jstree != null)) {
  if (chmtop.c2wtopf.FITEMS[chmtop.c2wtopf.pagenum] != chmtop.c2wtopf.pageid)
    chmtop.c2wtopf.jstree.OpenTreeNode("sources/" + chmtop.c2wtopf.pageid);
}
</script>

<!-- CHM2WEB -->
<!-- DO NOT DELETE OR MODIFY THIS CODE WITHOUT 
     WRITTEN PERMISSION OF A!K RESEARCH LABS -->
<table width="100%" cellspacing="0" cellpadding="0" 
style="margin-top: 0pt; border-collapse: collapse;"> 
<tr> <td align="right" style="background-color:white; border-top: 1px solid gray;"> 
<a href="http://chm2web.aklabs.com" target="_blank" style="font-family: sans-serif;  font-size: 11px; text-decoration: none;"><font color="gray">Converted from CHM to HTML with <b>chm2web Pro 2.85 (unicode)</b></font></a>
</td></tr></table> 
<!-- /CHM2WEB -->

</body>
</html>
